!function(t){"use strict";var e=function(t){var e,i,o;for(i in e=[],t)o=t[i],e.push(window.encodeURIComponent(i)+"="+window.encodeURIComponent(o));return e.join("&")},i={fr:{"layers.traffic":"Trafic","layers.transport":"Transports en commun","layers.photo":"Vue aérienne","layers.hybrid":"Afficher le nom des lieux","trafficLegend.trafficAt":"Trafic à {hours}:{minutes}","trafficLegend.slow":"ralenti","trafficLegend.blocked":"fermé","vehicle.comcar":"Petite voiture","vehicle.midcar":"Voiture de taille moyenne","vehicle.sedcar":"Routière","vehicle.luxcar":"Grande routière","vehicle.caravancar":"Véhicule avec caravane","vehicle.2-lt3.5":"Poids lourd, PTAC < 3.5T (2 essieux)","vehicle.2-lt12":"Poids lourd, PTAC < 12T (2 essieux)","vehicle.2-gt12":"Poids lourd, PTAC > 12T (2 essieux)","vehicle.2-gt12a":"Poids lourd, PTAC > 12T, articulé (2 essieux)","vehicle.3-lt3.5":"Poids lourd, PTAC < 3.5T (3 essieux ou plus)","vehicle.3-lt12":"Poids lourd, PTAC < 12T (3 essieux ou plus)","vehicle.3-gt12":"Poids lourd, PTAC > 12T (3 essieux ou plus)","vehicle.3-gt12a":"Poids lourd, PTAC > 12T, articulé (3 essieux ou plus)","vehicle.mot":"Moto","vehicle.van":"Camping car","vehicle.2-coa":"Bus 2 essieux","vehicle.3-coa":"Bus 3 essieux","vehicle.ped":"Piéton","vehicle.bik":"Vélo","vehicle.bike":"Vélo en libre-service","vehicle.pub_tp":"Transports en commun","bikelegend.title":"Pistes cyclables"},en:{"layers.traffic":"Traffic","layers.transport":"Public transports","layers.photo":"Satellite photos","layers.hybrid":"Display locations names","trafficLegend.trafficAt":"Traffic at {hours}:{minutes}","trafficLegend.slow":"slow","trafficLegend.blocked":"congested","vehicle.comcar":"Compact car","vehicle.midcar":"Medium-size car","vehicle.sedcar":"Sedan car","vehicle.luxcar":"Luxury car","vehicle.caravancar":"Vehicle with caravan","vehicle.2-lt3.5":"Truck, GVWR < 3.5T (2 axles)","vehicle.2-lt12":"Truck, GVWR < 12T (2 axles)","vehicle.2-gt12":"Truck, GVWR > 12T (2 axles)","vehicle.2-gt12a":"Truck, GVWR > 12T, articulated (2 axles)","vehicle.3-lt3.5":"Truck, GVWR < 3.5T (3 axles or more)","vehicle.3-lt12":"Truck, GVWR < 12T (3 axles or more)","vehicle.3-gt12":"Truck, GVWR > 12T (3 axles or more)","vehicle.3-gt12a":"Truck, GVWR > 12T, articulated (3 axles or more)","vehicle.mot":"Motorbike","vehicle.van":"Campervan","vehicle.2-coa":"Bus 2 axles","vehicle.3-coa":"Bus 3 axles","vehicle.ped":"Pedestrian","vehicle.bik":"Bicycle","bikelegend.title":"Bicycle paths"},nl:{"layers.traffic":"Verkeer","layers.transport":"Openbaar vervoer","layers.photo":"Luchtfoto's","layers.hybrid":"Locaties weergeven namen","trafficLegend.trafficAt":"Verkeer op {hours}:{minutes}","trafficLegend.slow":"langzaam","trafficLegend.blocked":"vastgelopen","vehicle.comcar":"Kleine auto","vehicle.midcar":"Middelgrote auto","vehicle.sedcar":"Grote auto","vehicle.luxcar":"Luxeauto","vehicle.caravancar":"Voertuig met caravan","vehicle.2-lt3.5":"Vrachtwagen, MTM < 3,5 T (2 assen)","vehicle.2-lt12":"Vrachtwagen, MTM < 12 T (2 assen)","vehicle.2-gt12":"Vrachtwagen, MTM > 12 T (2 assen)","vehicle.2-gt12a":"Vrachtwagen, MTM > 12 T, met oplegger (2 assen)","vehicle.3-lt3.5":"Vrachtwagen, MTM < 3,5 T (3 of meer assen)","vehicle.3-lt12":"Vrachtwagen, MTM < 12 T (3 of meer assen)","vehicle.3-gt12":"Vrachtwagen, MTM > 12 T (3 of meer assen)","vehicle.3-gt12a":"Vrachtwagen, MTM > 12 T, met oplegger (3 of meer assen)","vehicle.mot":"Motor","vehicle.van":"Camping car","vehicle.2-coa":"Bus 2 assen","vehicle.3-coa":"Bus 3 assen","vehicle.ped":"Voetganger","vehicle.bik":"Fiets","bikelegend.title":"Fietspaden"}};t.Mappy={version:"5.3.0",_domain:"mappy.net",_token:"g0ztPgTHGBpIzhtEqb8IVksxgvRO/VCtTwFgtyNXgrE1AkVLgdBHwFgwpQ55cR5jtxZX0O5W1nY=",_clientId:null,_https:"https"===document.location.protocol.substr(0,5),_locale:"fr_FR",getText:function(t){return i[this._locale.substr(0,2)][t]||""},setLocale:function(t){if("fr_FR"!==t&&"en_GB"!==t&&"fr_BE"!==t&&"nl_BE"!==t)throw new Error("This locale is not available");this._locale=t},getLocale:function(){return this._locale},setToken:function(t){throw new Error("setToken is deprecated in favor of setClientId (refer to documentation)")},_getToken:function(){return this._token},setClientId:function(e){this._clientId=e,this._clientId&&((new Image).src="http"+(t.Mappy._getHttps()?"s":"")+"://log."+t.Mappy._getDomain()+"/log/1.0/ping/api-leaflet/"+this._clientId+"/"+t.Mappy.version)},_getClientId:function(){return this._clientId},enableHttps:function(){this._https=!0},disableHttps:function(){this._https=!1},_getHttps:function(){return this._https},_getDomain:function(){return this._domain},_checkClientId:function(){if(!this._getClientId())throw new Error("ClientId is mandatory (refer to documentation).")},JSONP:function(i){var o,n,s,a,r;if(0===(a={data:(i=i||{}).data||{},error:i.error||t.Util.falseFn,success:i.success||t.Util.falseFn,url:i.url||""}).url.length)throw new Error("MissingUrl");return n=!1,o=a.data[i.callback_name||"callback"]="jsonp_"+function(t){var e;for(e="";e.length<t;)e+=Math.random().toString(36)[2];return e}(15),window[o]=function(t){a.success(t),window[o]=null},(r=window.document.createElement("script")).src=a.url,r.src+=a.url.indexOf(!1)?"?":"&",r.src+=e(a.data),r.async=!0,r.onerror=function(t){return a.error({url:r.src,event:t})},r.onload=r.onreadystatechange=function(){if(!(n||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState)&&(n=!0,r.onload=r.onreadystatechange=null,r&&r.parentNode))return r.parentNode.removeChild(r)},(s=s||window.document.getElementsByTagName("head")[0]).appendChild(r)},cors:function(t){var i;window.XDomainRequest?(i=new XDomainRequest,t.data?i.open("GET",t.url+"?"+e(t.data)):i.open("GET",t.url),t.error&&(i.onerror=t.error),i.onload=function(){t.success(JSON.parse(i.responseText))},i.send()):window.XMLHttpRequest?(i=new XMLHttpRequest,t.data?i.open("GET",t.url+"?"+e(t.data),!0):i.open("GET",t.url,!0),i.onerror=t.error,i.onreadystatechange=function(){4===i.readyState&&(i.status>=200&&i.status<400?t.success(JSON.parse(i.responseText)):t.error&&t.error(new Error("Response returned with non-OK status")))},i.send()):t.error(new Error("CORS not supported"))}};var o=t.Control.Attribution.extend({options:{scale:!0,position:"bottomleft",prefix:'&copy; <a href="http://corporate.mappy.com/conditions-dutilisation/copyright/" title="Mappy" target="_blank">Mappy</a> '},_layers:[],onAdd:function(e){e.on("layeradd",function(e){e.layer instanceof t.Mappy.TileLayer&&(this._layers.push(e.layer),e.layer.on("attributionsrefresh",this._refreshAttributions,this))},this),e.on("layerremove",function(t){for(var e=this._layers.length-1;e>=0;e--)this._layers[e]===t.layer&&(this._layers.splice(e,1),t.layer.off("attributionsrefresh",this._refreshAttributions,this),this._refreshAttributions())},this);var i=t.Control.Attribution.prototype.onAdd.call(this,e);return this.options.scale&&t.control.scale({imperial:!1,position:this.options.position}).addTo(e),i},addTo:function(e){this._map=e;var i=this._container=this.onAdd(e),o=this.getPosition(),n=e._controlCorners[o];return t.DomUtil.addClass(i,"leaflet-control"),n.appendChild(i),this},removeFrom:t.Util.falseFn,remove:t.Util.falseFn,clearAttributions:function(){this._attributions={},this._update()},_refreshAttributions:function(){this.clearAttributions();for(var t=[],e=this._layers.length-1;e>=0;e--)t=t.concat(this._layers[e].getAttributions());for(var i=0;i<t.length;i++)this.addAttribution(t[i])}});t.Mappy.Control=t.Control.extend({options:{position:"topright",singleToolBox:!1},statics:{mainContainer:null},_buttons:{},_tooltips:{},addTo:function(e){return this._buttons={},this._tooltips={},t.Control.prototype.addTo.call(this,e),t.DomUtil.addClass(this._container,"mappy-control"),this},removeFrom:function(e){var i=this.getPosition(),o=e._controlCorners[i];return(!this.options.singleToolBox||this.options.singleToolBox&&t.Mappy.Control.mainContainer)&&(o.removeChild(this._container),this._container=null),this.options.singleToolBox&&t.Mappy.Control.mainContainer&&(t.Mappy.Control.mainContainer=null),this._map=null,this.onRemove&&this.onRemove(e),this},_createContainer:function(e){return this._container=t.DomUtil.create("div","mappy-control-"+e),this._container},_getContainer:function(e){return this.options.singleToolBox?(t.Mappy.Control.mainContainer||(t.Mappy.Control.mainContainer=t.DomUtil.create("div","mappy-control-main")),t.Mappy.Control.mainContainer):t.DomUtil.create("div","mappy-control-"+e)},_createBasicButton:function(e,i){var o=t.DomUtil.create("a","mappy-button mappy-button-"+i,this._container);return o.innerHTML=e||"",o.href="#",t.DomEvent.on(o,"mousedown",t.DomEvent.stop).on(o,"dblclick",t.DomEvent.stop).on(o,"click",t.DomEvent.stop),o},_createButton:function(e,i,o,n){var s=this._createBasicButton(e,o);return this._initTooltip(i,o,s),t.DomEvent.on(s,"click",n,this).on(s,"click",this._refocusOnMap,this),s},_createSwitch:function(e,i,o,n,s,a,r){var l=this._createBasicButton(e,n);return this._initTooltip(i,n,l,r),t.DomEvent.on(l,"click",function(e){t.DomUtil.hasClass(l,"mappy-button-active")?(this.deactivateButton(l),this._updateTooltipContent(i,n),a.call(this,e)):(this.activateButton(l),this._updateTooltipContent(o,n),s.call(this,e)),this._refocusOnMap()},this),l},_initTooltip:function(e,i,o,n){e&&(t.Browser.touch?t.DomEvent.on(o,"click",function(){this._closeTooltips(),this._createTooltip(e,i,o),t.Mappy.layerTooltip&&clearInterval(t.Mappy.layerTooltip),t.Mappy.layerTooltip=setTimeout(t.bind(function(){this._closeTooltip(i)},this),2e3)},this):t.DomEvent.on(o,"mouseenter",function(){this._closeTooltips(),this._createTooltip(e,i,o)},this).on(o,"mouseleave",function(){this._closeTooltip(i,n)},this))},_createTooltip:function(e,i,o){if(this._tooltips[i])this._container.appendChild(this._tooltips[i]);else{var n=t.DomUtil.create("div","mappy-tooltip",this._container);"string"==typeof e?n.innerHTML=e:n.appendChild(e),this._tooltips[i]=n}this._tooltips[i].style.top=o.offsetTop+(o.offsetHeight-this._tooltips[i].offsetHeight)/2+"px"},_updateTooltipContent:function(t,e){this._tooltips[e]&&t&&("string"==typeof t?this._tooltips[e].innerHTML=t:this._tooltips[e].appendChild(t))},_closeTooltip:function(e,i){this._removing=setTimeout(t.bind(function(){this._tooltips[e].parentNode&&this._container.removeChild(this._tooltips[e])},this),i||0)},_closeTooltips:function(){for(var t in clearTimeout(this._removing),this._tooltips)this._tooltips[t].parentNode&&this._tooltips[t].parentNode.removeChild(this._tooltips[t])},activateButton:function(e){t.DomUtil.addClass(e,"mappy-button-active"),e.setAttribute("data-active",1)},deactivateButton:function(e){t.DomUtil.removeClass(e,"mappy-button-active"),e.setAttribute("data-active",0)}});var n=t.Mappy.Control.extend({options:{geolocationMarker:!1,locateOptions:{}},_defaultLocateOptions:{setView:!0,maxZoom:15,timeout:5e3,maximumAge:3e4},onAdd:function(e){return this.options.locateOptions=t.extend(this._defaultLocateOptions,this.options.locateOptions),this._container=t.DomUtil.create("div","mappy-control-geolocation"),this._geolocButton=this._createButton("<span>?</span>",null,"geolocation",this.activateGeolocation),e.on("locationfound",this.onGeolocationSuccess,this),e.on("locationerror",this.onGeolocationError,this),e.on("moveend zoomend",this.deactivate,this),this._container},activateGeolocation:function(){t.DomUtil.removeClass(this._geolocButton,"geolocation-error"),t.DomUtil.addClass(this._geolocButton,"searching"),this._map.fire("locationsearch"),this._map.locate(this.options.locateOptions)},onRemove:function(t){t.off("locationfound",this.onGeolocationSuccess,this)},onGeolocationSuccess:function(e){if(t.DomUtil.removeClass(this._geolocButton,"searching"),this.activateButton(this._geolocButton),this.options.geolocationMarker)if(this.geolocationMarker)this.geolocationMarker.setLatLng(e.latlng);else{var i=new t.DivIcon({className:"geolocationMarker",iconSize:[30,30],iconAnchor:[15,15]});this.geolocationMarker=t.marker(e.latlng,{icon:i}).addTo(this._map)}},onGeolocationError:function(e){t.DomUtil.removeClass(this._geolocButton,"searching"),t.DomUtil.addClass(this._geolocButton,"geolocation-error"),this._map.on("moveend zoomend",t.bind(function(){t.DomUtil.removeClass(this._geolocButton,"geolocation-error")},this))},deactivate:function(){this.deactivateButton(this._geolocButton)}});t.Control.Layers=t.Mappy.Control.extend({options:{autoZIndex:!0,traffic:!0,publicTransport:!0,viewMode:!0,trafficLegend:!0},initialize:function(e,i,o){for(var n in t.setOptions(this,o),this._buttons={},this.trafficLegend=null,this._layers={},this._lastZIndex=0,e)this._addLayer(e[n],n);for(n in i)this._addLayer(i[n],n,!0)},_addLayer:function(e,i,o){var n=t.stamp(e);this._layers[n]={layer:e,name:i,overlay:o},this.options.autoZIndex&&e.setZIndex&&(this._lastZIndex++,e.setZIndex(this._lastZIndex))},onAdd:function(t){return this._container=this._getContainer("layers"),this._initLayout(),this._initActiveButton(),t.on("layeradd",this._onLayerChange,this).on("layerremove",this._onLayerChange,this),this._container},onRemove:function(t){t.off("layeradd",this._onLayerChange,this).off("layerremove",this._onLayerChange,this),this.options.trafficLegend&&this.trafficLegend.hide()},_initLayout:function(){if(!1!==this.options.traffic&&(this._buttons.traffic=this._createSwitch("<span>'</span>",t.Mappy.getText("layers.traffic"),null,"traffic",this.activateTraffic,this.deactivateTraffic)),!1!==this.options.publicTransport&&(this._buttons.publicTransport=this._createSwitch("<span>7</span>",t.Mappy.getText("layers.transport"),null,"transport",this.activatePublicTransport,this.deactivatePublicTransport)),this.options.trafficLegend&&(this.trafficLegend=t.control.TrafficLegend()),!1!==this.options.viewMode){var e=t.DomUtil.create("div"),i=t.DomUtil.create("span",null,e),o=this._createCheckbox(e),n=t.DomUtil.create("label",null,e);this._buttons.hybrid=o,i.innerHTML=t.Mappy.getText("layers.photo"),n.innerHTML=t.Mappy.getText("layers.hybrid"),n.setAttribute("for","mappy-hybrid"),this._buttons.aerial=this._createSwitch("<span>#</span>",e,null,"aerial",function(){this._map.setViewmode("photo")},function(){this._map.setViewmode("standard"),this._map.getTilelayer("overlay")&&"hybrid"===this._map.getTilelayer("overlay").options.name&&this._map.setOverlay()},500),t.DomEvent.on(e,"mouseenter",this._onAerialTooltipMouseEnter,this).on(e,"mouseleave",this._onAerialTooltipMouseLeave,this).on(o,"click",this._onAerialLabelClick,this)}},_initActiveButton:function(){var t=this._map.getTilelayer("overlay");t&&this._addOverlay(t.options.name),this._updateViewMode(this._map.getTilelayer().options.name)},_onLayerChange:function(e){var i=this._layers[t.stamp(e.layer)];if(i){var o=i.overlay?"layeradd"===e.type?"overlayadd":"overlayremove":"layeradd"===e.type?"baselayerchange":null;i.overlay?"overlayremove"===o?this._removeOverlay(i.name):this._addOverlay(i.name):this._updateViewMode(i.name),o&&this._map.fire(o,i)}},_removeOverlay:function(t){"traffic"===t?(this._buttons.traffic&&this.deactivateButton(this._buttons.traffic),this.trafficLegend&&this.trafficLegend.hide()):"public_transport"===t&&this._buttons.publicTransport?this.deactivateButton(this._buttons.publicTransport):"hybrid"===t&&this._buttons.hybrid&&(this._buttons.hybrid.checked=!1)},_addOverlay:function(t){"traffic"===t?(this._buttons.traffic&&this.activateButton(this._buttons.traffic),this.trafficLegend&&this.trafficLegend.show(this._map)):"public_transport"===t&&this._buttons.publicTransport&&this.activateButton(this._buttons.publicTransport),this._buttons.hybrid&&(this._buttons.hybrid.checked="hybrid"===t)},_updateViewMode:function(t){this._buttons.aerial&&("standard"===t?this.deactivateButton(this._buttons.aerial):this.activateButton(this._buttons.aerial))},activateTraffic:function(t){this._map.setOverlay("traffic"),this.trafficLegend&&this.trafficLegend.show(this._map)},deactivateTraffic:function(){this._map.setOverlay(),this.trafficLegend&&this.trafficLegend.hide()},activatePublicTransport:function(){this._map.setOverlay("public_transport")},deactivatePublicTransport:function(){this._map.setOverlay()},_createCheckbox:function(t){var e=document.createElement("div");return e.innerHTML='<input type="checkbox" name="mappy-hybrid-checkbox" id="mappy-hybrid" />',t.appendChild(e.firstChild)},_onAerialTooltipMouseEnter:function(t){clearTimeout(this._removing)},_onAerialTooltipMouseLeave:function(t){this._closeTooltip("aerial",500)},_onAerialLabelClick:function(t){this._buttons.hybrid&&this._buttons.hybrid.checked?("photo"!==this._map.getTilelayer().options.name&&this._map.setViewmode("photo"),this._map.setOverlay("hybrid")):this._map.setOverlay()},getTrafficLegend:function(){return this.trafficLegend}});var s=t.Control.extend({options:{position:"bottomright"},initialize:function(e){this.options=t.extend({},this.options,e)},onAdd:function(e){this._container=t.DomUtil.create("div","mappy-bike-legend");var i=t.DomUtil.create("div","mappy-bike-legend-col mappy-bike-legend-left",this._container),o=t.DomUtil.create("div","mappy-bike-legend-col mappy-bike-legend-right",this._container);t.DomUtil.create("span","mappy-bike-legend-bicyclepath-box",i);return t.DomUtil.create("p","mappy-bike-legend-title",o).innerHTML=t.Mappy.getText("bikelegend.title"),this._container}}),a=t.Control.extend({options:{position:"topleft",dir:"../images/"},onAdd:function(e){this._container=t.DomUtil.create("div","mappy-control-logo");var i=t.DomUtil.create("img","mappy-logo",this._container);return i.src=this.options.dir+(t.Browser.retina?"api-logo-2x.png":"api-logo.png"),i.style.display="block",i.width="50",i.height="12",i.onerror=function(){throw new Error("Logo is not accessible.")},this._container},removeFrom:t.Util.falseFn,remove:t.Util.falseFn});t.Mappy.TileLayer=t.TileLayer.extend({options:{minZoom:0,maxZoom:19,tileSize:256,subdomains:"1234"},tileUrl:"http{h}://map{s}.{domain}/map/1.0/slab/{m}/256/{z}/{x}/{y}",descrUrl:"http{h}://map1.{domain}/map/1.0/multi-descr/{m}/256/{z}/{t}",descrInfos:{},attributions:[],layerItems:[],initialize:function(e,i,o){o=t.setOptions(this,t.extend({h:t.Mappy._getHttps()?"s":"",m:e,name:e,zIndex:i,domain:t.Mappy._getDomain()},o)),"photo"!==e&&o.detectRetina&&t.Browser.retina&&(this.options.m+="_hd"),"traffic"===e&&(this.tileUrl+="?refresh={refresh}",o.refresh={toString:function(){return Math.random()}}),t.TileLayer.prototype.initialize.call(this,this.tileUrl,o)},onAdd:function(e){t.TileLayer.prototype.onAdd.call(this,e),this.on("load",this._onLoad),"traffic"===this.options.name&&(this.interval=window.setInterval(t.bind(this.redraw,this),12e4))},onRemove:function(e){t.TileLayer.prototype.onRemove.call(this,e),this.off("load",this._onLoad),"traffic"===this.options.name&&window.clearInterval(this.interval)},getAttributions:function(){return this.attributions},_onLoad:function(){var t=this._map.getPixelBounds(),e=t.min.clone(),i=t.max.clone();e=e.divideBy(this.options.tileSize)._floor(),i=i.divideBy(this.options.tileSize)._floor();var o=[];this._adjustTilePoint(e),this._adjustTilePoint(i);for(var n=e.x;n<=i.x;n++)for(var s=e.y;s<=i.y;s++)o.push(n+","+s);o.length>0&&this._requestDescr(o)},_refreshAttributions:function(t){if(this._map){this.attributions=[],this.layerItems=[];for(var e=0;e<t.length;e++){var i=this.options.m+"/"+this._map.getZoom()+"/"+t[e].replace(",","/");if(this.descrInfos[i]){for(var o=0;o<this.descrInfos[i].copyrights.length;o++)this.attributions.push(this.descrInfos[i].copyrights[o].name);this.layerItems=this.layerItems.concat(this.descrInfos[i].items)}}this.fire("attributionsrefresh")}},_requestDescr:function(e){for(var i=this._map.getZoom(),o=[],n=0;n<e.length;n++){var s=this.options.m+"/"+i+"/"+e[n].replace(",","/");this.descrInfos[s]||o.push(e[n])}if(o.length>0){var a=t.Util.template(this.descrUrl,t.extend({z:i,t:o.join(";")},this.options));t.Mappy.cors({url:a,success:t.bind(function(t){for(var i=0;i<t.length;i++)this.descrInfos[this.options.m+"/"+t[i].sid]=t[i];this._refreshAttributions(e)},this)})}else this._refreshAttributions(e)},_update:function(){if(this._map){var e=this._map,i=e.getPixelBounds(),o=e.getZoom(),n=this._getTileSize();if(o>this.options.maxZoom||o<this.options.minZoom)this._reset({hard:!0});else{var s=t.bounds(i.min.divideBy(n)._floor(),i.max.divideBy(n)._floor());this._addTilesFromCenterOut(s),(this.options.unloadInvisibleTiles||this.options.reuseTiles)&&this._removeOtherTiles(s)}}}});var r,l,h,c=t.Class.extend({options:{width:"auto",minWidth:"",maxWidth:"",showDelay:500,hideDelay:500,mouseOffset:t.point(0,20),fadeAnimation:!0,trackMouse:!1},initialize:function(e){t.setOptions(this,e),this._createTip()},_createTip:function(){if(this._map=this.options.map,!this._map)throw new Error("No map configured for tooltip");this._container=t.DomUtil.create("div","leaflet-tooltip"),t.DomUtil.addClass(this._container,"mappy-tooltip-transport"),this._container.style.position="absolute",this._container.style.width=this._isNumeric(this.options.width)?this.options.width+"px":this.options.width,this._container.style.minWidth=this._isNumeric(this.options.minWidth)?this.options.minWidth+"px":this.options.minWidth,this._container.style.maxWidth=this._isNumeric(this.options.maxWidth)?this.options.maxWidth+"px":this.options.maxWidth,this.options.html&&this.setHtml(this.options.html),this.options.target&&this.setTarget(this.options.target),this._map._tooltipContainer.appendChild(this._container)},isVisible:function(){return this._showing},setTarget:function(t){t._icon&&(t=t._icon),t!==this._target&&(this._target&&this._unbindTarget(this._target),this._bindTarget(t),this._target=t)},_bindTarget:function(e){t.DomEvent.on(e,"mouseover",this._onTargetMouseover,this).on(e,"mouseout",this._onTargetMouseout,this).on(e,"mousemove",this._onTargetMousemove,this)},_unbindTarget:function(e){t.DomEvent.off(e,"mouseover",this._onTargetMouseover,this).off(e,"mouseout",this._onTargetMouseout,this).off(e,"mousemove",this._onTargetMousemove,this)},setHtml:function(t){if("string"==typeof t)this._container.innerHTML=t;else{for(;this._container.hasChildNodes();)this._container.removeChild(this._container.firstChild);this._container.appendChild(this._content)}this._sizeChanged=!0},setPosition:function(t){var e=this._map.getSize(),i=this._container,o=this._getElementSize(this._container);(t=t.add(this.options.mouseOffset)).x+o.x>e.x?(i.style.left="auto",i.style.right=e.x-t.x+"px"):(i.style.left=t.x+"px",i.style.right="auto"),t.y+o.y>e.y?(i.style.top="auto",i.style.bottom=e.y-t.y+2*this.options.mouseOffset.y+"px"):(i.style.top=t.y+"px",i.style.bottom="auto")},remove:function(){this._container.parentNode.removeChild(this._container),delete this._container,this._target&&this._unbindTarget(this._target)},show:function(t,e){c.activeTip&&c.activeTip!=this&&c.activeTip._hide(),c.activeTip=this,e&&this.setHtml(e),this.setPosition(t),this.options.showDelay?this._delay(this._show,this,this.options.hideDelay):this._show()},_show:function(){this._container.style.display="inline-block",t.DomUtil.addClass(this._container,"leaflet-tooltip-fade"),this._showing=!0},hide:function(){this.options.hideDelay?this._delay(this._hide,this,this.options.hideDelay):this._hide()},_hide:function(){this._timeout&&clearTimeout(this._timeout),t.DomUtil.removeClass(this._container,"leaflet-tooltip-fade"),this._container.style.display="none",this._showing=!1,c.activeTip===this&&delete c.activeTip},_delay:function(t,e,i){var o=this;this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(function(){t.call(e),delete o._timeout},i)},_isNumeric:function(t){return!isNaN(parseFloat(t))&&isFinite(t)},_getElementSize:function(t){var e=this._size;return e&&!this._sizeChanged||(e={},t.style.left="-999999px",t.style.right="auto",t.style.display="inline-block",e.x=t.offsetWidth,e.y=t.offsetHeight,t.style.left="auto",t.style.display="none",this._sizeChanged=!1),e},_onTargetMouseover:function(t){var e=this._map.mouseEventToContainerPoint(t);this.show(e)},_onTargetMousemove:function(e){if(t.DomEvent.stopPropagation(e),this.options.trackMouse){var i=this._map.mouseEventToContainerPoint(e);this.setPosition(i)}},_onTargetMouseout:function(t){this.hide()}});t.Map.addInitHook(function(){this._tooltipContainer=t.DomUtil.create("div","leaflet-tooltip-container",this._container)}),r=t.Marker.prototype.onAdd,l=t.Marker.prototype.onRemove,h=t.Marker.prototype.setIcon,t.Marker.include({getTooltip:function(){return this._tooltip},onAdd:function(e){r.call(this,e),this.options.tooltip&&(this._tooltip=c(t.extend(this.options.tooltip,{target:this,map:e})))},onRemove:function(t){this._tooltip&&this._tooltip.remove(),l.call(this,t)},setIcon:function(t){h.call(this,t),this._tooltip&&this._tooltip.setTarget(this._icon)}}),t.Control.TrafficLegend=t.Mappy.Control.extend({options:{position:"bottomright"},_initLayout:function(){this._container=t.DomUtil.create("div","mappy-traffic-legend clearfix");t.DomUtil.create("p","mappy-traffic-legend-title",this._container);var e=t.DomUtil.create("table","",this._container),i=t.DomUtil.create("tr","",e);return t.DomUtil.create("td","orange",i),t.DomUtil.create("td","red",i),t.DomUtil.create("td","darkred",i),t.DomUtil.create("td","black",i),t.DomUtil.create("p","left",this._container).innerHTML=t.Mappy.getText("trafficLegend.slow"),t.DomUtil.create("p","right",this._container).innerHTML=t.Mappy.getText("trafficLegend.blocked"),this._container},show:function(e){if(this._map)return this.refresh(),void(this._container&&t.DomUtil.addClass(this._container.parentElement,"leaflet-control-with-traffic"));this.addTo(e),this._container&&t.DomUtil.addClass(this._container.parentElement,"leaflet-control-with-traffic")},hide:function(){this._container&&t.DomUtil.removeClass(this._container.parentElement,"leaflet-control-with-traffic"),this._map&&(this.removeFrom(this._map),this._map=null)},onAdd:function(){return this._container||this._initLayout(),this.refresh(),this.interval=window.setInterval(t.bind(this.refresh,this),12e4),this._container},onRemove:function(){window.clearInterval(this.interval)},refresh:function(){var e=new Date;this._container.querySelector("p.mappy-traffic-legend-title").innerHTML=t.Util.template(t.Mappy.getText("trafficLegend.trafficAt"),{hours:e.getHours(),minutes:(e.getMinutes()<10?"0":"")+e.getMinutes()})}}),t.control.TrafficLegend=function(e){return new t.Control.TrafficLegend(e)},t.Control.Zoom=t.Mappy.Control.extend({options:{zoomSlider:!1},onAdd:function(t){return this._container=this._getContainer("zoom"),this._initLayout(),this._container},onRemove:function(t){t.off("zoomlevelschange",this._updateSize,this).off("zoomend zoomlevelschange",this._updateKnobValue,this)},_initLayout:function(){var t=this.options.zoomSlider?" mappy-button-zoom-full":"";this._buttons.zoomIn=this._createButton("<span>+</span>",null,"zoom-in"+t,function(t){this._map.zoomIn(t.shiftKey?3:1)}),this.options.zoomSlider&&(this._buttons.slider=this._createSlider(),this._buttons.knob=new p(this._buttons.slider.knob,8,8),this._map.whenReady(this._initKnob,this).whenReady(this._initEvents,this).whenReady(this._updateSize,this).whenReady(this._updateKnobValue,this)),this._buttons.zoomOut=this._createButton("<span>-</span>",null,"zoom-out"+t,function(t){this._map.zoomOut(t.shiftKey?3:1)})},_createSlider:function(){var e={};return e.bar=t.DomUtil.create("div","mappy-slider",this._container),e.wrap=t.DomUtil.create("div","mappy-slider-wrap",e.bar),e.body=t.DomUtil.create("div","mappy-slider-body",e.wrap),e.knob=t.DomUtil.create("div","mappy-slider-knob"),t.DomEvent.disableClickPropagation(e.bar),t.DomEvent.disableClickPropagation(e.knob),e},_initKnob:function(){this._buttons.knob.enable(),this._buttons.slider.body.appendChild(this._buttons.slider.knob)},_initEvents:function(){this._map.on("zoomlevelschange",this._updateSize,this).on("zoomend zoomlevelschange",this._updateKnobValue,this),t.DomEvent.on(this._buttons.slider.body,"click",this._onSliderClick,this),this._buttons.knob.on("dragend",this._updateMapZoom,this)},_onSliderClick:function(e){var i=e.touches&&1===e.touches.length?e.touches[0]:e,o=t.DomEvent.getMousePosition(i,this._buttons.slider.body).y;this._buttons.knob.setPosition(o),this._updateMapZoom()},_zoomLevels:function(){var t=this._map.getMaxZoom()-this._map.getMinZoom()+1;return t<1/0?t:0},_toZoomLevel:function(t){return t+this._map.getMinZoom()},_toValue:function(t){return t-this._map.getMinZoom()},_updateSize:function(){var t=this._zoomLevels();this._buttons.slider.body.style.height=8*t+"px",this._buttons.knob.setSteps(t)},_updateMapZoom:function(){this._map.setZoom(this._toZoomLevel(this._buttons.knob.getValue()))},_updateKnobValue:function(){this._buttons.knob.setValue(this._toValue(this._map.getZoom()))}});var p=t.Draggable.extend({initialize:function(e,i,o){t.Draggable.prototype.initialize.call(this,e,e),this._element=e,this._stepHeight=i,this._knobHeight=o,this.on("predrag",function(){this._newPos.x=0,this._newPos.y=this._adjust(this._newPos.y)},this)},_adjust:function(t){var e=Math.round(this._toValue(t));return e=Math.max(0,Math.min(this._maxValue,e)),this._toY(e)},_toY:function(t){return this._k*t+this._m},_toValue:function(t){return(t-this._m)/this._k},setSteps:function(t){var e=t*this._stepHeight;this._maxValue=t-1,this._k=-this._stepHeight,this._m=e-(this._stepHeight+this._knobHeight)/2},setPosition:function(e){t.DomUtil.setPosition(this._element,t.point(0,this._adjust(e)))},setValue:function(t){this.setPosition(this._toY(t))},getValue:function(){return this._toValue(t.DomUtil.getPosition(this._element).y)}});t.Mappy.Map=t.Map.extend({_tileLayers:{},_tooltip:null,disabledActions:[],initialize:function(e,i){(i=i||{}).clientId&&t.Mappy.setClientId(i.clientId),t.Mappy._checkClientId();var r=void 0===i.zoomControl||i.zoomControl;i.zoomControl=!1;var l=void 0!==i.attributionControl?i.attributionControl:{};i.attributionControl=!1,i.maxBounds=i.maxBounds||t.latLngBounds(t.latLng(-90,-1e5),t.latLng(90,1e5)),i.worldCopyJump=void 0===i.worldCopyJump||i.worldCopyJump,i.zoomAnimationThreshold=void 0!==i.zoomAnimationThreshold?i.zoomAnimationThreshold:3,this.baseLayers={standard:new t.Mappy.TileLayer("standard",1,i.tileLayerOptions),photo:new t.Mappy.TileLayer("photo",1,i.tileLayerOptions)};var h={minZoom:i.tileLayerOptions&&i.tileLayerOptions.minZoom>6?i.tileLayerOptions.minZoom:6};this.overlays={public_transport:new t.Mappy.TileLayer("public_transport",2,t.extend({},i.tileLayerOptions,h)),traffic:new t.Mappy.TileLayer("traffic",2,i.tileLayerOptions),hybrid:new t.Mappy.TileLayer("hybrid",2,i.tileLayerOptions)},t.Map.prototype.initialize.call(this,e,i),this.attributionControl=new o(l).addTo(this),!1!==i.logoControl&&(this.logoControl=new a(i.logoControl||{}).addTo(this)),i.viewmode&&this.baseLayers[i.viewmode]?this.addLayer(this.baseLayers[i.viewmode]):this.addLayer(this.baseLayers.standard),!1!==r&&(this.zoomControl=t.control.zoom(r||{}).addTo(this)),(void 0===i.layersControl||i.layersControl)&&(this.layersControl=t.control.layers(this.baseLayers,this.overlays,i.layersControl||{}).addTo(this)),i.geolocationControl&&"geolocation"in navigator&&(this.geolocationControl=new n(i.geolocationControl).addTo(this)),i.legendControl&&(this.legendControl=new s(i.legendControl).addTo(this)),this._tooltip=new c({map:this,showDelay:0,hideDelay:0}),this.on("mousemove",this._handleMousemove),this.on("move",this._tooltip.hide,this._tooltip),this.on("zoomstart",this._tooltip.hide,this._tooltip),t.Browser.touch||t.DomUtil.addClass(this._container,"no-touch")},setViewmode:function(t){t=t||"standard",this._setTileLayer(this.baseLayers,t),this.baseLayers[t]&&this.fire("viewmode-"+t,this.baseLayers[t])},setOverlay:function(t){this._setTileLayer(this.overlays,t),this.fire("overlay-"+(t||"disabled"),this.overlays[t]?this.overlays[t]:null)},disableInteractions:function(){var t=["dragging","touchZoom","scrollWheelZoom","doubleClickZoom","boxZoom","keyboard"];this.disabledActions=[];for(var e=0;e<t.length;e++)this[t[e]]&&this[t[e]].enabled()&&(this.disabledActions.push(t[e]),this[t[e]].disable())},enableInteractions:function(){for(var t=0;t<this.disabledActions.length;t++)this[this.disabledActions[t]].enable()},getTilelayer:function(t){var e="overlay"===t?this.overlays:this.baseLayers;for(var i in e)if(this.hasLayer(e[i]))return e[i];return null},_setTileLayer:function(t,e){for(var i in t)this.hasLayer(t[i])&&this.removeLayer(t[i]);return t[e]&&this.addLayer(t[e]),this},_handleMousemove:function(t){var e=this.getTilelayer();if(e){e=e.layerItems;var i=this.getTilelayer("overlay");i&&(e=e.concat(i.layerItems));for(var o=0,n=!1;o<e.length&&!n;){var s=e[o].box;s.minx<t.latlng.lng&&t.latlng.lng<s.maxx&&s.miny<t.latlng.lat&&t.latlng.lat<s.maxy&&(this._tooltip.isVisible()||this._showItemTooltip(e[o]),n=!0),o++}n||this._tooltip.hide()}},_showItemTooltip:function(e){var i="http"+(t.Mappy._getHttps()?"s":"")+"://logotc."+t.Mappy._getDomain()+"/pictos/web/desktop/",o={M:"metro",S:"rer",T:"train",TY:"tram"},n=[],s=e.properties.description.line;s=s instanceof Array?s:[s];for(var a=0;a<s.length;a++)n[s[a].type]||(n[s[a].type]=[]),n[s[a].type].push(s[a].num);var r="";for(var l in n)if(n.hasOwnProperty(l)){var h=o[l]||l,c=['<img src="'+i+"modes/"+h+'.png" />'];for(var p in n[l])if(n[l].hasOwnProperty(p)){var u="tram"===h?"t"+n[l][p].toLowerCase():n[l][p].toLowerCase();c.push('<img src="'+i+"lines/stif_"+h+"_"+u+'.png" />')}r+="</p><p>"+c.join("")}var d=this.latLngToContainerPoint(t.latLng((e.box.maxy+e.box.miny)/2,(e.box.maxx+e.box.minx)/2));this._tooltip.show(d,"<div><p><span>"+e.properties.description.label+"</span>"+r+"</p></div>")},getScaleZoom:function(t){return this._zoom+Math.log(t)/Math.log(3)},addLegendControl:function(t){t=t||this.options.legendControl||{},this.legendControl||(this.legendControl=new s(t.legendControl).addTo(this))},removeLegendControl:function(){this.legendControl&&(this.legendControl.removeFrom(this),this.legendControl=null)}}),t.Handler.MarkerDrag.prototype._onDrag=function(){var e=this._marker,i=e._shadow,o=t.DomUtil.getPosition(e._icon),n=e._map.containerPointToLayerPoint([0,0]),s=e._map.containerPointToLayerPoint(e._map.getSize()),a=new t.Point(Math.max(n.x+5,Math.min(o.x,s.x-5)),Math.min(s.y-5,Math.max(o.y,n.y+15)));t.DomUtil.setPosition(e._icon,a);var r=e._map.layerPointToLatLng(a);i&&t.DomUtil.setPosition(i,a),e._latlng=r,e.fire("move",{latlng:r}).fire("drag")},t.Mappy.Route=t.FeatureGroup.extend({initialize:function(e,i,o){t.FeatureGroup.prototype.initialize.call(this),this.polylineStepIdx=[];for(var n=e.route[i||0].actions.action,s=0;s<n.length;s++)"waypoint"===n[s].type&&(this._createStepMarker(t.latLng(n[s].y,n[s].x),"mappy-route-step"),this.polylineStepIdx.push(parseInt(n[s]["polyline-index"],10)));this.colorDictionary=e["color-dictionary"].color,this.colorDictionary.length||(this.colorDictionary=[this.colorDictionary]),this.alternative=!!o,this.route=e.route[i||0]["polyline-definition"],this.points=t.polyline(this.route.polyline).getLatLngs(),this._createShapes(),this._createStepMarker(this.points[0],"mappy-route-start"),this._createStepMarker(this.points[this.points.length-1],"mappy-route-end")},_createShapes:function(){var e,i,o=this.route["road-section-collection"]["road-sections"];if(t.polyline(this.points,{color:"#FFF",weight:9,opacity:.58}).addTo(this),o instanceof Array)for(var n=0;n<o.length;n++)"bike-facility"===o[n].type?i=o[n]["road-section"].split(" "):e=o[n]["road-section"].split(" ");else e=o["road-section"].split(" ");for(var s=this._parseSection(e),a=0;a<s.length;a++){t.polyline(s[a].polyline,{color:s[a].color,opacity:.58}).addTo(this);for(var r=!1,l=0;l<this.polylineStepIdx.length;l++)this.polylineStepIdx[l]===s[a].sliceEnd&&(r=!0);s[a].sliceEnd<this.points.length-1&&!r&&t.marker(this.points[s[a].sliceEnd],{icon:new t.DivIcon({className:"mappy-connexion-marker",iconSize:[10,10],iconAnchor:[5,5]})}).addTo(this)}this._applyBikeFacility(i)},_parseSection:function(t){for(var e,i,o,n,s=[],a=0,r=0;r<t.length;r+=2){for(var l in e=parseInt(t[r+1],10),i="",this.colorDictionary)this.colorDictionary[l].value!==t[r]||!this.alternative&&-1!==this.colorDictionary[l].type.indexOf("-alt")||(i=this.colorDictionary[l].color,o=this.colorDictionary[l].type,n=this.colorDictionary[l].value);var h=this.points.slice(a,e+1);a=e,s.push({polyline:h,color:i,type:o,sliceEnd:e,colorValue:n})}return s},_applyBikeFacility:function(e){if(e)for(var i=this._parseSection(e),o=0;o<i.length;o++)"bike-facility"===i[o].type&&"0"!==i[o].colorValue&&t.polyline(i[o].polyline,{color:i[o].color,weight:6,opacity:1}).addTo(this)},_createStepMarker:function(e,i){t.marker(e,{icon:new t.DivIcon({className:"iti-marker "+i,html:'<span class="icon icon-flag"></span>',iconSize:[40,50],iconAnchor:[20,50]})}).addTo(this)}}),t.Mappy.route=function(e,i,o){return new t.Mappy.Route(e,i,o)},t.Mappy.Vehicles=["comcar","midcar","sedcar","luxcar","caravancar","2-lt3.5","2-lt12","2-gt12","2-gt12a","3-lt3.5","3-lt12","3-gt12","3-gt12a","mot","van","2-coa","3-coa","ped","bik","bike","pub_tp"],t.Mappy.Services={localeParameters:{fr_FR:{favoriteCountry:250,language:"fre"},en_GB:{favoriteCountry:826,language:"eng"},fr_BE:{favoriteCountry:56,language:"fre"},nl_BE:{favoriteCountry:56,language:"dut"}},_decodePolyline:function(t){for(var e=t.length,i=[],o=[],n=0,s=0,a=0,r=function(){var e,i=0,o=0;do{o|=(31&(e=t.charCodeAt(n++)-63))<<i,i+=5}while(e>=32);return(1&o)>0?~(o>>1):o>>1};n<e;)i.push(r());for(var l=0;l<i.length;l+=2)s+=1e-5*i[l],a+=1e-5*i[l+1],o.push([s,a]);return o},geocode:function(e,i,o){t.Mappy._checkClientId(),e instanceof t.LatLng?e=e.lat+","+e.lng:e instanceof Array&&(e=e[0]+","+e[1]),t.Mappy.JSONP({url:"http"+(t.Mappy._getHttps()?"s":"")+"://axe."+t.Mappy._getDomain()+"/1v1/loc/get.aspx",data:{"opt.format":"json","opt.namedPlaceSearch":1,"opt.interactive":1,"opt.language":this.localeParameters[t.Mappy.getLocale()].language,"opt.favoriteCountry":this.localeParameters[t.Mappy.getLocale()].favoriteCountry,"opt.xmlOutput":"3v0",auth:t.Mappy._getToken(),fullAddress:e},success:function(t){if(!t.kml.Document)return i([]);var e=t.kml.Document.Placemark;e=e instanceof Array?e:[e],i(e)},error:o})},route:function(e){t.Mappy._checkClientId();var i,o,n={};if("function"==typeof arguments[1])i=arguments[1],o=arguments[2];else{for(var s in arguments[1])n[s]=arguments[1][s];i=arguments[2],o=arguments[3]}this._requestRoute(e,n,i,o)},_requestRoute:function(e,i,o,n){var s,a,r=t.extend(i||{},{clientid:t.Mappy._getClientId(),wt:"json",from:"",to:"",vehicle:i.vehicle||"comcar"});r=this._getNormalizedVehicleOptions(r);for(var l=0;l<e.length;l++)s=t.latLng(e[l]),0===l?a="from":l===e.length-1?a="to":(a="stops",r.stops=r.stops||""),r[a]+=("stops"===a&&l>1?";":"")+s.lng+","+s.lat;var h="pub_tp"===i.vehicle||"bike"===i.vehicle?"route":"route_vehicle";this._request("cors","http"+(t.Mappy._getHttps()?"s":"")+"://routemm."+t.Mappy._getDomain()+"/"+h+"/roadbook",r,o,n)},_request:function(e,i,o,n,s){t.Mappy[e]({url:i,data:o,success:t.bind(function(t){try{if(t.routes.route.length||(t.routes.route=[t.routes.route]),!t.routes.route[0].actions)throw new Error(t.routes.route[0].stats.error);for(var e=0;e<t.routes.route.length;e++){var i=this._decodePolyline(t.routes.route[e]["polyline-definition"].polyline);t.routes.route[e]["polyline-definition"].polyline=i}n(t)}catch(t){s(t)}},this),error:s})},_getNormalizedVehicleOptions:function(t){var e={from:"from",to:"to",stops:"stops",clientid:"clientid",infotraffic:"rb.infotraffic",date:"rt.date",time:"rt.time",sens:"rt.sens",notoll:"rt.notoll",cost:"rt.cost",lang:"rb.lang",axl:"rb.axl",gas:"rb.gas",nbroutes:"rt.nbroutes",cvn:"rb.cvn",wt:"wt",veh:"rb.veh",criteria:"criteria"},i={};for(var o in t)e[o]&&(i[e[o]]=t[o]);return"pub_tp"===t.vehicle||"bike"===t.vehicle?i.transport_mode=t.vehicle:i["rb.veh"]=t.vehicle,/^2-/.test(t.vehicle)&&(i["rb.veh"]=t.vehicle.replace(/^(2-)/,""),i["rb.axl"]="2ax"),/^3-/.test(t.vehicle)&&(i["rb.veh"]=t.vehicle.replace(/^(3-)/,""),i["rb.axl"]="3ax"),"caravancar"===t.vehicle&&(i["rb.veh"]="midcar",i["rb.cvn"]="1"),i}}}(window.L);